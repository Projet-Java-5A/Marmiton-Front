<div class="form-container">
  <h2>Modifier la recette</h2>
  <form *ngIf="recetteForm" [formGroup]="recetteForm" (ngSubmit)="onSubmit()">
    
    <div class="form-group">
      <label for="nom">Nom de la recette</label>
      <input id="nom" type="text" formControlName="nom">
    </div>

    <div class="form-group">
      <label for="imageUrl">URL de l'image</label>
      <input id="imageUrl" type="text" formControlName="imageUrl">
    </div>

    <div class="form-group">
      <label for="duree">Durée (minutes)</label>
      <input id="duree" type="number" formControlName="duree">
    </div>

    <div class="form-group">
      <label for="difficulte">Difficulté</label>
      <select id="difficulte" formControlName="difficulte">
        <option *ngFor="let star of stars" [value]="star">{{star}}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="prix">Prix</label>
      <select id="prix" formControlName="prix">
        <option *ngFor="let range of priceRanges" [value]="range">{{range}}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="contenu">Instructions</label>
      <textarea id="contenu" formControlName="contenu" rows="10"></textarea>
    </div>

    <div class="form-group">
      <h4>Ingrédients</h4>
      <div formArrayName="ingredients">
        <div *ngFor="let ingredient of ingredients.controls; let i=index" [formGroupName]="i" class="ingredient-row">
          
          <!-- MODIFIÉ : Suppression de l'événement (change) -->
          <select formControlName="id" class="form-control">
            <option *ngFor="let ing of allIngredients" [value]="ing.id_ingredient">{{ing.nom_ingredient}}</option>
          </select>
          
          <input type="text" formControlName="quantite" placeholder="Quantité" class="form-control">
          <button type="button" (click)="removeIngredient(i)" class="btn-remove">Supprimer</button>
        </div>
      </div>
      <button type="button" (click)="addIngredient()" class="btn-add">Ajouter un ingrédient</button>
    </div>


    <div class="form-actions">
      <!-- MODIFICATION CI-DESSOUS -->
      <button type="submit" [disabled]="recetteForm.invalid || recetteForm.pristine">Sauvegarder les modifications</button>
      <!-- Optionnellement, vous pouvez aussi appliquer cette logique au bouton Approuver si besoin -->
      <button type="button" (click)="approve()">Approuver</button>
      <button type="button" (click)="cancel()">Annuler</button>
    </div>
  </form>

  <!-- AJOUTEZ CE BLOC POUR LE DÉBOGAGE -->
  <div *ngIf="recetteForm" style="background-color: #f0f0f0; margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
    <h3>État du formulaire (pour débogage)</h3>
    <pre>État de validité : {{ recetteForm.status }}</pre> <!-- Doit être VALID -->
    <pre>État Pristine (intact) : {{ recetteForm.pristine }}</pre> <!-- Doit passer à false après une modif -->
    <pre>État Dirty (modifié) : {{ recetteForm.dirty }}</pre> <!-- Doit passer à true après une modif -->
    <pre>Valeurs : {{ recetteForm.value | json }}</pre>
  </div>
</div>
