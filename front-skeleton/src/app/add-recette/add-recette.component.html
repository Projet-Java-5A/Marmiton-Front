<div class="add-recette-container">

  <div class="form-container">
    <form [formGroup]="recetteForm" (ngSubmit)="onSubmit()" class="recette-form">
      <h2>Ajouter une nouvelle recette</h2>

      <mat-form-field appearance="fill">
        <mat-label>Nom de la recette</mat-label>
        <input matInput formControlName="name" required>
        <mat-error *ngIf="recetteForm.get('name')?.hasError('required')">
          Le nom est requis
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Ingrédients</mat-label>
        <mat-select formControlName="ingredients" multiple>
          <mat-option *ngFor="let ingredient of ingredientsList" [value]="ingredient">
            {{ ingredient.nom_ingredient }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="recetteForm.get('ingredients')?.hasError('required')">
          Au moins un ingrédient est requis
        </mat-error>
      </mat-form-field>

      <!-- Section pour les quantités -->
      <div *ngIf="quantitiesFormArray.controls.length > 0" class="quantities-section" formArrayName="quantities">
        <h4>Quantités</h4>
        <div *ngFor="let quantityGroup of quantitiesFormArray.controls; let i = index" [formGroupName]="i" class="quantity-item">
          <span class="ingredient-name">{{ quantityGroup.value.ingredientName }}:</span>
          <mat-form-field appearance="outline" class="quantity-input">
            <mat-label>Quantité (ex: 100g, 2, ...)</mat-label>
            <input matInput formControlName="quantity" required>
          </mat-form-field>
        </div>
      </div>

      <!-- NOUVEAU : Champ pour la sélection des ustensiles -->
      <mat-form-field appearance="fill">
        <mat-label>Ustensiles nécessaires</mat-label>
        <mat-select formControlName="ustensiles" multiple>
          <mat-option *ngFor="let ustensile of ustensilesList" [value]="ustensile">
            {{ ustensile.nomUstensileDto }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="recetteForm.get('ustensiles')?.hasError('required')">
          Au moins un ustensile est requis
        </mat-error>
      </mat-form-field>

      <!-- Champ Image -->
      <mat-form-field appearance="fill">
        <mat-label>URL de l'image</mat-label>
        <input matInput formControlName="image">
      </mat-form-field>

      <!-- Textarea extensible -->
      <mat-form-field appearance="fill">
        <mat-label>Étapes de la recette</mat-label>
        <textarea matInput 
                  formControlName="steps" 
                  required 
                  cdkTextareaAutosize
                  #autosize="cdkTextareaAutosize"
                  cdkAutosizeMinRows="5"
                  cdkAutosizeMaxRows="20"></textarea>
        <mat-error *ngIf="recetteForm.get('steps')?.hasError('required')">
          Les étapes sont requises
        </mat-error>
      </mat-form-field>

      <!-- Champ pour la durée -->
      <mat-form-field appearance="fill">
        <mat-label>Durée de la recette (en minutes)</mat-label>
        <input matInput type="number" formControlName="dureeRecette" required>
        <mat-error *ngIf="recetteForm.get('dureeRecette')?.hasError('required')">
          La durée est requise
        </mat-error>
      </mat-form-field>

      <!-- Sélecteur de gamme de prix -->
      <mat-form-field appearance="fill">
        <mat-label>Estimation du prix</mat-label>
        <mat-select formControlName="price" required>
          <mat-option *ngFor="let range of priceRanges" [value]="range">{{ range }}</mat-option>
        </mat-select>
        <mat-error *ngIf="recetteForm.get('price')?.hasError('required')">
          Le prix est requis
        </mat-error>
      </mat-form-field>

      <!-- Sélecteur de difficulté par étoiles -->
      <div class="difficulty-container">
        <label id="difficulty-label">Difficulté:</label>
        <div class="star-rating">
          <button mat-icon-button *ngFor="let star of stars" (click)="rate(star)" type="button">
            <mat-icon>{{ recetteForm.get('difficulty')?.value >= star ? 'star' : 'star_border' }}</mat-icon>
          </button>
        </div>
      </div>

      <button mat-raised-button color="primary" type="submit" [disabled]="!recetteForm.valid">
        Ajouter la recette
      </button>
    </form>
  </div>

  <!-- Print de l'image -->
  <div class="preview-container">
    <h4>Aperçu de l'image</h4>
    <img *ngIf="recetteForm.get('image')?.value" [src]="recetteForm.get('image')?.value" alt="Aperçu de la recette" class="image-preview">
  </div>
</div>
<div>
    TODO : Rajouter la possibilité de rajouter des ingrédients pas présents dans la liste
    avec un bouton (le nom et la  catégorie donc GET x) + (Validation admin ?)
</div>
<div>
    TODO : Faire en sorte que cette page ne soit accessible que lorsque connecter
</div>
<div>
    TODO : Modifier les boutons pour rajouter une photo, pour mettre une note (avec des étoiles), pour le prix par pallier de 10€, celui de la recherche d'ingrédient car possibilité de le faire par les types d'ingrédients( légumes, fruit ...)
</div>